<HTML>

<!----------------------------------------------------------------------------->
<!--                  START OF AUTOMATICALLY GENERATED HTML FILE             -->
<!----------------------------------------------------------------------------->
<!--                                                                         -->
<!-- This HTML file was generated by the FunnelWeb literate programming      -->
<!-- preprocessor. You can display this file using popular web browsers      -->
<!-- such as Netscape Navigator and Microsoft Internet Explorer.             -->
<!--                                                                         -->
<!-- FunnelWeb is a preprocessor that allows programmers to weave programs   -->
<!-- and their documentation together in a single document. The FunnelWeb    -->
<!-- program analyses such documents producing both program files and        -->
<!-- typeset documentation such as this HTML file.                           -->
<!--                                                                         -->
<!-- FunnelWeb was created by Ross N. Williams (www.ross.net) and is         -->
<!-- available free of charge under a GNU General Public Licence.            -->
<!-- The FunnelWeb website can be found at http://www.ross.net/funnelweb/    -->
<!--                                                                         -->
<!----------------------------------------------------------------------------->

<HEAD>

<TITLE>Package spreading_activation</TITLE>

<STYLE TYPE="text/css">
<!--
A {text-decoration: none}
H1 { font-family: sans-serif; font-size: large }
H2 { font-family: sans-serif; font-size: medium; font-weight: bold }
H3 { font-family: sans-serif; font-size: medium }
H4 { font-family: sans-serif; font-size: small }
H5 { font-family: sans-serif; font-size: small }
// -->
</STYLE>

</HEAD>
<BODY BGCOLOR=#FFFFFF TEXT=#000000 LINK=#CC0033 VLINK=#CC0033 ALINK=#CC0000>

<BR>

<BR>

<BR>

<BR>

<TABLE CELLSPACING=0 CELLPADDING=0 BORDER=0><TR><TD WIDTH=400>
<DIV STYLE="font-family: sans-serif" ALIGN=center><FONT SIZE=7>Semantic Engine C++ API</FONT></DIV>
</TD></TR></TABLE><BR>
<TABLE CELLSPACING=0 CELLPADDING=0 BORDER=0><TR><TD WIDTH=400>
<DIV STYLE="font-family: sans-serif" ALIGN=center><FONT SIZE=5>Ranking: Spreading Activation</FONT></DIV>
</TD></TR></TABLE><BR>
<TABLE CELLSPACING=0 CELLPADDING=0 BORDER=0><TR><TD WIDTH=400>
<DIV STYLE="font-family: sans-serif" ALIGN=center><FONT SIZE=4>By Gabriel Schine</FONT></DIV>
</TD></TR></TABLE><BR>
<P><TABLE CELLSPACING=0 CELLPADDING=0 BORDER=0><TR><TD WIDTH=400>

This file describes the ranking operations used by the
Semantic Engine.

<P></TD></TR></TABLE>
<BR>


<A HREF="#sec_1">1. Ranking: Spreading Activation</A><BR>

<P><HR SIZE=4 NOSHADE><P><A NAME="sec_1"></A>
<H1>1. Ranking: Spreading Activation</H1>
<P><TABLE CELLSPACING=0 CELLPADDING=0 BORDER=0><TR><TD WIDTH=400>

Spreading activation is a ranking operation that can be performed on a number of nodes.
In order to perform this operation, we need the following:

<P>* A graph

<P>* A list of start nodes and associated start energies

<P>* "energy_hit" counters for the graph and any edges in the graph

<P>The <FONT COLOR=#000033><TT>spreading_activation</TT></FONT> function takes four arguments:

<P>* <FONT COLOR=#000033><TT>Graph &amp;g</TT></FONT> is a <FONT COLOR=#000033><TT>boost::adjacency_list</TT></FONT> of some sort.

<P>* <FONT COLOR=#000033><TT>NodeMap &amp;n</TT></FONT> is an <B>Associative Container</B> such as <FONT COLOR=#000033><TT>std::map&lt;se_graph_traits&lt;Graph&gt;::vertex_id_type, double&gt;</TT></FONT>,
which maps a vertex (by id) in the <FONT COLOR=#000033><TT>Graph</TT></FONT> with a starting energy.

<P>* <FONT COLOR=#000033><TT>WeightMap</TT></FONT> is a BOOST property map, keyed by edge, defining the weight of each edge. It need not be normalized.

<P>* <FONT COLOR=#000033><TT>RankMap</TT></FONT> is the output map, again a BOOST property map, keyed by vertex.

<P></TD></TR></TABLE>
<FONT COLOR=#CC0033>
<P><A NAME="1"></A>1. <A HREF="#8">spreading activation function</A>={<FONT COLOR=#000033><TT><BR>
template&nbsp;&lt;class&nbsp;Graph,&nbsp;class&nbsp;NodeMap,&nbsp;class&nbsp;WeightMap,&nbsp;class&nbsp;RankMap&gt;<BR>
void&nbsp;spreading_activation(Graph&nbsp;&amp;g,&nbsp;NodeMap&nbsp;&amp;n,&nbsp;WeightMap&nbsp;w,&nbsp;RankMap&nbsp;r)<BR>
{<BR>
&nbsp;&nbsp;&nbsp;&nbsp;typedef&nbsp;typename&nbsp;se_graph_traits&lt;Graph&gt;::vertex_iterator&nbsp;viterator;<BR>
&nbsp;&nbsp;&nbsp;&nbsp;typedef&nbsp;typename&nbsp;se_graph_traits&lt;Graph&gt;::out_edge_iterator&nbsp;eiterator;<BR>
&nbsp;&nbsp;&nbsp;&nbsp;typedef&nbsp;typename&nbsp;se_graph_traits&lt;Graph&gt;::vertex_id_type&nbsp;id_type;<BR>
&nbsp;&nbsp;&nbsp;&nbsp;typedef&nbsp;typename&nbsp;se_graph_traits&lt;Graph&gt;::edge_descriptor&nbsp;edge_desc;<BR>
&nbsp;&nbsp;&nbsp;&nbsp;<BR>
&nbsp;&nbsp;&nbsp;&nbsp;</TT>
<A HREF="#3">initialize starting energies</A><TT><BR>
&nbsp;&nbsp;&nbsp;&nbsp;<BR>
&nbsp;&nbsp;&nbsp;&nbsp;//&nbsp;create&nbsp;the&nbsp;seen&nbsp;set<BR>
&nbsp;&nbsp;&nbsp;&nbsp;std::set&lt;edge_desc&gt;&nbsp;seen;<BR>
&nbsp;&nbsp;&nbsp;&nbsp;//&nbsp;and&nbsp;our&nbsp;map&nbsp;of&nbsp;vertices<BR>
&nbsp;&nbsp;&nbsp;&nbsp;std::map&lt;id_type,&nbsp;typename&nbsp;se_graph_traits&lt;Graph&gt;::vertex_descriptor&gt;&nbsp;vertex_map;<BR>
&nbsp;&nbsp;&nbsp;&nbsp;<BR>
&nbsp;&nbsp;&nbsp;&nbsp;//&nbsp;get&nbsp;those&nbsp;vertex&nbsp;descriptors&nbsp;from&nbsp;the&nbsp;graph<BR>
&nbsp;&nbsp;&nbsp;&nbsp;g.vertices_by_id(extract_first_iterator(n.begin()),&nbsp;extract_first_iterator(n.end()),&nbsp;inserter(vertex_map,&nbsp;vertex_map.end()));<BR>
<BR>
&nbsp;&nbsp;&nbsp;&nbsp;</TT>
<A HREF="#4">spider starting nodes</A><TT><BR>
}</TT>
</FONT>}<BR>
</FONT>
<FONT SIZE=1>This macro is invoked in definition <A HREF="#8">8</A>.</FONT><BR>
<P><TABLE CELLSPACING=0 CELLPADDING=0 BORDER=0><TR><TD WIDTH=400>


<P>The spidering algorithm looks like so:

<P></TD></TR></TABLE>
<FONT COLOR=#CC0033>
<P><A NAME="2"></A>2. <A HREF="#8">spider node</A>={<FONT COLOR=#000033><TT><BR>
template&nbsp;&lt;class&nbsp;Graph,&nbsp;class&nbsp;WeightMap,&nbsp;class&nbsp;RankMap&gt;<BR>
void&nbsp;activation_spider(<BR>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Graph&nbsp;&amp;g,&nbsp;<BR>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;typename&nbsp;se_graph_traits&lt;Graph&gt;::vertex_descriptor&nbsp;u,&nbsp;<BR>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;WeightMap&nbsp;w,&nbsp;RankMap&nbsp;r,&nbsp;<BR>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;int&nbsp;energy_hits,&nbsp;<BR>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;typename&nbsp;property_traits&lt;RankMap&gt;::value_type&nbsp;energy,&nbsp;<BR>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;std::set&lt;typename&nbsp;se_graph_traits&lt;Graph&gt;::edge_descriptor&gt;&nbsp;&amp;seen)<BR>
{<BR>
&nbsp;&nbsp;&nbsp;&nbsp;if&nbsp;(energy_hits&nbsp;==&nbsp;0)&nbsp;return;&nbsp;//&nbsp;don't&nbsp;even&nbsp;go&nbsp;there!&nbsp;*snap*&nbsp;--&nbsp;only&nbsp;if&nbsp;we&nbsp;won't&nbsp;be&nbsp;modifying&nbsp;anything<BR>
&nbsp;&nbsp;&nbsp;&nbsp;</TT>
<A HREF="#5">get total out edge weight for node</A><TT><BR>
&nbsp;&nbsp;&nbsp;&nbsp;</TT>
<A HREF="#6">add current energy to current node</A><TT><BR>
&nbsp;&nbsp;&nbsp;&nbsp;</TT>
<A HREF="#7">iterate out edges and spider them</A><TT><BR>
}</TT>
</FONT>}<BR>
</FONT>
<FONT SIZE=1>This macro is invoked in definition <A HREF="#8">8</A>.</FONT><BR>
<P><TABLE CELLSPACING=0 CELLPADDING=0 BORDER=0><TR><TD WIDTH=400>


<P>The rest is just writing the individual parts.

<P></TD></TR></TABLE>
<FONT COLOR=#CC0033>
<P><A NAME="3"></A>3. <A HREF="#1">initialize starting energies</A>={<FONT COLOR=#000033><TT>BGL_FORALL_VERTICES_T(v,&nbsp;g,&nbsp;Graph)&nbsp;put(r,&nbsp;v,&nbsp;0);</TT>
</FONT>}<BR>
</FONT>
<FONT SIZE=1>This macro is invoked in definition <A HREF="#1">1</A>.</FONT><BR>
<FONT COLOR=#CC0033>
<P><A NAME="4"></A>4. <A HREF="#1">spider starting nodes</A>={<FONT COLOR=#000033><TT><BR>
for(typename&nbsp;NodeMap::iterator&nbsp;i&nbsp;=&nbsp;n.begin();&nbsp;i&nbsp;!=&nbsp;n.end();&nbsp;++i)&nbsp;{<BR>
&nbsp;&nbsp;&nbsp;&nbsp;//&nbsp;id&nbsp;is&nbsp;i-&gt;first,&nbsp;starting&nbsp;energy&nbsp;is&nbsp;i-&gt;second<BR>
&nbsp;&nbsp;&nbsp;&nbsp;id_type&nbsp;id&nbsp;=&nbsp;(*i).first;<BR>
&nbsp;&nbsp;&nbsp;&nbsp;detail::activation_spider(g,&nbsp;vertex_map[id],&nbsp;w,&nbsp;r,&nbsp;get_property(g,&nbsp;graph_energy_hits),&nbsp;(*i).second,&nbsp;seen);<BR>
}</TT>
</FONT>}<BR>
</FONT>
<FONT SIZE=1>This macro is invoked in definition <A HREF="#1">1</A>.</FONT><BR>
<FONT COLOR=#CC0033>
<P><A NAME="5"></A>5. <A HREF="#2">get total out edge weight for node</A>={<FONT COLOR=#000033><TT><BR>
typename&nbsp;property_traits&lt;RankMap&gt;::value_type&nbsp;total&nbsp;=&nbsp;0;<BR>
BGL_FORALL_OUTEDGES_T(u,&nbsp;e,&nbsp;g,&nbsp;Graph)&nbsp;total&nbsp;+=&nbsp;get(w,&nbsp;e);</TT>
</FONT>}<BR>
</FONT>
<FONT SIZE=1>This macro is invoked in definition <A HREF="#2">2</A>.</FONT><BR>
<P><TABLE CELLSPACING=0 CELLPADDING=0 BORDER=0><TR><TD WIDTH=400>


<P>When adding energy, we need to take into account energy_hits -- the number of times we "hit" this edge while
building the subgraph. This is an abstract concept, and how the value is set is defined in the subgraph policy.

<P></TD></TR></TABLE>
<FONT COLOR=#CC0033>
<P><A NAME="6"></A>6. <A HREF="#2">add current energy to current node</A>={<FONT COLOR=#000033><TT>put(r,&nbsp;u,&nbsp;get(r,&nbsp;u)&nbsp;+&nbsp;energy&nbsp;*&nbsp;energy_hits);</TT>
</FONT>}<BR>
</FONT>
<FONT SIZE=1>This macro is invoked in definition <A HREF="#2">2</A>.</FONT><BR>
<FONT COLOR=#CC0033>
<P><A NAME="7"></A>7. <A HREF="#2">iterate out edges and spider them</A>={<FONT COLOR=#000033><TT><BR>
typename&nbsp;se_graph_traits&lt;Graph&gt;::out_edge_iterator&nbsp;ei,&nbsp;ei_end;<BR>
for(boost::tie(ei,&nbsp;ei_end)&nbsp;=&nbsp;out_edges(u,&nbsp;g);&nbsp;ei&nbsp;!=&nbsp;ei_end;&nbsp;++ei)&nbsp;{<BR>
&nbsp;&nbsp;&nbsp;&nbsp;if&nbsp;(!seen.count(*ei))&nbsp;{<BR>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;seen.insert(*ei);<BR>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;//&nbsp;we&nbsp;haven't&nbsp;seen&nbsp;this&nbsp;vertex&nbsp;yet,&nbsp;spider&nbsp;it!<BR>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;activation_spider(g,&nbsp;target(*ei,&nbsp;g),&nbsp;w,&nbsp;r,&nbsp;g[*ei].energy_hits,&nbsp;energy&nbsp;*&nbsp;(get(w,&nbsp;*ei)&nbsp;/&nbsp;total),&nbsp;seen);<BR>
&nbsp;&nbsp;&nbsp;&nbsp;}<BR>
}</TT>
</FONT>}<BR>
</FONT>
<FONT SIZE=1>This macro is invoked in definition <A HREF="#2">2</A>.</FONT><BR>
<FONT COLOR=#CC0033>
<P><A NAME="8"></A><B>8. File:</B> semantic/ranking/spreading_activation.hpp={<FONT COLOR=#000033><TT><BR>
#ifndef&nbsp;_SPREADING_ACTIVATION_HPP_<BR>
#define&nbsp;_SPREADING_ACTIVATION_HPP_<BR>
<BR>
</TT>
<A HREF="#9">includes</A><TT><BR>
<BR>
namespace&nbsp;semantic&nbsp;{<BR>
&nbsp;&nbsp;&nbsp;&nbsp;namespace&nbsp;detail&nbsp;{<BR>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</TT>
<A HREF="#2">spider node</A><TT><BR>
&nbsp;&nbsp;&nbsp;&nbsp;}&nbsp;//&nbsp;namespace&nbsp;detail<BR>
&nbsp;&nbsp;&nbsp;&nbsp;<BR>
&nbsp;&nbsp;&nbsp;&nbsp;</TT>
<A HREF="#1">spreading activation function</A><TT><BR>
}&nbsp;//&nbsp;namespace&nbsp;semantic<BR>
<BR>
#endif&nbsp;/*&nbsp;_SPREADING_ACTIVATION_HPP_&nbsp;*/<BR>
</TT>
</FONT>}<BR>
</FONT>
<FONT SIZE=1>This macro is attached to an output file.</FONT>
<FONT COLOR=#CC0033>
<P><A NAME="9"></A>9. <A HREF="#8">includes</A>={<FONT COLOR=#000033><TT><BR>
#include&nbsp;&lt;semantic/semantic.hpp&gt;<BR>
#include&nbsp;&lt;semantic/utility.hpp&gt;<BR>
<BR>
#include&nbsp;&lt;map&gt;<BR>
#include&nbsp;&lt;set&gt;<BR>
#include&nbsp;&lt;iterator&gt;<BR>
</TT>
</FONT>}<BR>
</FONT>
<FONT SIZE=1>This macro is invoked in definition <A HREF="#8">8</A>.</FONT><BR>
<P>
<HR SIZE=4 NOSHADE>
<CENTER><B>End Of File</B></CENTER>
<HR SIZE=4 NOSHADE>
</BODY>

<!----------------------------------------------------------------------------->
<!--                   END OF AUTOMATICALLY GENERATED HTML FILE              -->
<!----------------------------------------------------------------------------->
</HTML>
